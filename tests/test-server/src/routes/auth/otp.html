<nav>
  <a data-testid="nav-index" href="/">index</a>
  <a data-testid="nav-auth" href="/auth" class="selected">auth</a>
</nav>

<h1 data-testid="header">Sign In</h1>

<!-- invalid opt line -->

<form action="/auth/otp" method="POST">
  <input type="hidden" name="email" value="{{email}}" />
  <input data-testid="otp-input" type="text" name="otp" placeholder="OTP" required />
  <button data-testid="submit-server" type="submit">Submit OTP With Server</button>
  <button data-testid="submit-client" type="button">Submit OTP With Client</button>
</form>

<script type="importmap">
  {
    "imports": {
      "better-auth/client/plugins": "https://esm.sh/better-auth@latest/client/plugins",
      "better-auth/client": "https://esm.sh/better-auth@latest/client"
    }
  }
</script>
<script type="module">
  import { createAuthClient } from "better-auth/client";
  import { conjoinedEmailClientPlugin } from "/lib/index.client.js";

  export const authClient = createAuthClient({
    plugins: [conjoinedEmailClientPlugin()],
  });

  const clientBtn = document.querySelector('button[type="button"]');
  const otpInput = document.querySelector('input[name="otp"]');
  const email = "{{email}}";

  clientBtn.addEventListener("click", () => {
    if (!otpInput.value) {
      alert("Please enter an OTP");
      return;
    }

    authClient.signIn.emailOtp({ email, otp: otpInput.value }).then(() => {
      window.location.href = "/";
    }).catch((err) => {
      alert(err.message);
    });
  });
</script>
