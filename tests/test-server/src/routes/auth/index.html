<nav>
  <a data-testid="nav-index" href="/">index</a>
  <a data-testid="nav-auth" href="/auth" class="selected">auth</a>
</nav>

<h1 data-testid="header">Sign In</h1>

<!-- missing email line -->

<form action="/auth/multi-email" method="POST">
  <input
    data-testid="email-input"
    type="email"
    name="email"
    placeholder="Email"
    autocomplete="email"
    required
  />
  <button data-testid="submit-server" type="submit">Sign In With Server</button>
  <button data-testid="submit-client" type="button">Sign In With Client</button>
</form>

<script type="importmap">
  {
    "imports": {
      "better-auth/client/plugins": "https://esm.sh/better-auth@latest/client/plugins",
      "better-auth/client": "https://esm.sh/better-auth@latest/client"
    }
  }
</script>
<script type="module">
  import { createAuthClient } from "better-auth/client";
  import { conjoinedEmailClient } from "/lib/index.client.js";

  export const authClient = createAuthClient({
    plugins: [conjoinedEmailClient()],
  });

  const clientBtn = document.querySelector('button[type="button"]');
  const emailInput = document.querySelector('input[name="email"]');

  clientBtn.addEventListener("click", () => {
    if (!emailInput.value) {
      alert("Please enter an email");
      return;
    }

    authClient.signIn.conjoinedEmail({ email: emailInput.value }).then(() => {
      window.location.href =
        "/auth?email=" + encodeURIComponent(emailInput.value);
    }).catch((err) => {
      alert(err.message);
    });
  });
</script>
